--- a/apertium/interchunk.cc
+++ b/apertium/interchunk.cc
@@ -108,10 +108,15 @@
   me = new MatchExe(t, finals);
  
   // attr_items
+  bool recompile_attrs = Compression::string_read(in) != string(pcre_version());
   for(int i = 0, limit = Compression::multibyte_read(in); i != limit; i++)
   {
     string const cad_k = UtfConverter::toUtf8(Compression::wstring_read(in));
     attr_items[cad_k].read(in);
+    wstring fallback = Compression::wstring_read(in);
+    if(recompile_attrs) {
+      attr_items[cad_k].compile(UtfConverter::toUtf8(fallback));
+    }
   }
 
   // variables
--- a/apertium/postchunk.cc
+++ b/apertium/postchunk.cc
@@ -107,10 +107,15 @@
   me = new MatchExe(t, finals);
  
   // attr_items
+  bool recompile_attrs = Compression::string_read(in) != string(pcre_version());
   for(int i = 0, limit = Compression::multibyte_read(in); i != limit; i++)
   {
     string const cad_k = UtfConverter::toUtf8(Compression::wstring_read(in));
     attr_items[cad_k].read(in);
+    wstring fallback = Compression::wstring_read(in);
+    if(recompile_attrs) {
+      attr_items[cad_k].compile(UtfConverter::toUtf8(fallback));
+    }
   }
 
   // variables
--- a/apertium/transfer.cc
+++ b/apertium/transfer.cc
@@ -22,6 +22,7 @@
 #include <apertium/string_utils.h>
 #include <lttoolbox/compression.h>
 #include <lttoolbox/xml_parse_util.h>
+#include <pcre.h>
 
 #include <cctype>
 #include <iostream>
@@ -110,10 +111,15 @@
   me = new MatchExe(t, finals);
  
   // attr_items
+  bool recompile_attrs = Compression::string_read(in) != string(pcre_version());
   for(int i = 0, limit = Compression::multibyte_read(in); i != limit; i++)
   {
     string const cad_k = UtfConverter::toUtf8(Compression::wstring_read(in));
     attr_items[cad_k].read(in);
+    wstring fallback = Compression::wstring_read(in);
+    if(recompile_attrs) {
+      attr_items[cad_k].compile(UtfConverter::toUtf8(fallback));
+    }
   }
 
   // variables
--- a/apertium/transfer_data.cc
+++ b/apertium/transfer_data.cc
@@ -179,6 +179,7 @@
 void
 TransferData::writeRegexps(FILE *output)
 {
+  Compression::string_write(string(pcre_version()), output);
   Compression::multibyte_write(attr_items.size(), output);

   map<wstring, wstring, Ltstr>::iterator it, limit;
@@ -186,8 +187,8 @@
   {
     Compression::wstring_write(it->first, output);
     ApertiumRE my_re;
-    //wcerr << it->second << endl;
     my_re.compile(UtfConverter::toUtf8(it->second));
     my_re.write(output);
+    Compression::wstring_write(it->second, output);
   }
 }
--- a/apertium/transfer_mult.cc
+++ b/apertium/transfer_mult.cc
@@ -107,10 +107,15 @@
   me = new MatchExe(t, finals);
  
   // attr_items
+  bool recompile_attrs = Compression::string_read(in) != string(pcre_version());
   for(int i = 0, limit = Compression::multibyte_read(in); i != limit; i++)
   {
     string const cad_k = UtfConverter::toUtf8(Compression::wstring_read(in));
     attr_items[cad_k].read(in);
+    wstring fallback = Compression::wstring_read(in);
+    if(recompile_attrs) {
+      attr_items[cad_k].compile(UtfConverter::toUtf8(fallback));
+    }
   }
 
   // variables
